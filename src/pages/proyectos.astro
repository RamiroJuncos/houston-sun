---
import "../styles/projects.css";
import Layout from "../layouts/Layout.astro";
import Hero from "../components/commons/hero/hero.astro";
import ProjectCard from "../components/project/proyectCard.astro";
import Banner from "../components/commons/banners/banner.astro";
import { proyectos } from "../data/projectData.js";
---

<Layout title="Proyectos" description="Proyectos">
  <Hero titulo="Proyectos" />
  <!-- Botones -->
  <div class="mt-6 mb-6 flex flex-wrap justify-center gap-3 px-2">
    <button
      class="filter-btn cursor-pointer rounded-full bg-[#69c7c7] px-5 py-1.5 text-sm font-bold text-[#1d1250] drop-shadow-[2px_2px_0_#7836cf] transition-all duration-150 active:translate-y-0.5 active:drop-shadow-none"
      data-filter="all"
    >
      Todos
    </button>
    <button
      class="filter-btn cursor-pointer rounded-full bg-[#69c7c7] px-5 py-1.5 text-sm font-bold text-[#1d1250] drop-shadow-[2px_2px_0_#7836cf] transition-all duration-150 active:translate-y-0.5 active:drop-shadow-none"
      data-filter="fullstack"
    >
      Full Stack
    </button>
    <button
      class="filter-btn cursor-pointer rounded-full bg-[#69c7c7] px-5 py-1.5 text-sm font-bold text-[#1d1250] drop-shadow-[2px_2px_0_#7836cf] transition-all duration-150 active:translate-y-0.5 active:drop-shadow-none"
      data-filter="frontend"
    >
      Frontend
    </button>
    <button
      class="filter-btn cursor-pointer rounded-full bg-[#69c7c7] px-5 py-1.5 text-sm font-bold text-[#1d1250] drop-shadow-[2px_2px_0_#7836cf] transition-all duration-150 active:translate-y-0.5 active:drop-shadow-none"
      data-filter="backend"
    >
      Backend
    </button>
  </div>

  <!-- Cards -->
  <div
    id="projects-container"
    class="4xl:px-96 flex flex-wrap justify-center gap-5 px-3 pt-5 xl:px-32 2xl:px-60"
  >
    {
      proyectos.map((proyecto) => (
        <ProjectCard
          titulo={proyecto.titulo}
          descripcion={proyecto.descripcion}
          imagen={proyecto.imagen}
          tecnologias={proyecto.tecnologias}
          demo={proyecto.demo}
          codigo={proyecto.codigo}
          categoria={proyecto.categoria}
        />
      ))
    }
  </div>

  <Banner />
</Layout>

<script is:inline>
  (function () {
    const VISIBLE_CLASS = "project-visible";
    const HIDDEN_CLASS = "project-hidden";
    const HIDE_TIMEOUT = 300;

    function initProjectFilter() {
      const container = document.getElementById("projects-container");
      const buttons = Array.from(document.querySelectorAll(".filter-btn"));
      if (!container || !buttons.length) return;

      const cards = Array.from(container.querySelectorAll("[data-categoria]"));
      if (!cards.length) return;

      function showCard(card) {
        card.style.display = "flex";
        requestAnimationFrame(() => {
          card.classList.remove(HIDDEN_CLASS);
          card.classList.add(VISIBLE_CLASS);
        });
      }

      function hideCard(card) {
        card.classList.remove(VISIBLE_CLASS);
        card.classList.add(HIDDEN_CLASS);
        setTimeout(() => {
          if (card.classList.contains(HIDDEN_CLASS))
            card.style.display = "none";
        }, HIDE_TIMEOUT);
      }

      function applyFilter(filter) {
        const normalized = filter.toLowerCase();
        cards.forEach((card) => {
          const categoria = (
            card.getAttribute("data-categoria") ?? ""
          ).toLowerCase();
          const match = normalized === "all" || categoria === normalized;
          match ? showCard(card) : hideCard(card);
        });
      }

      function setActive(btn) {
        buttons.forEach((b) => b.classList.remove("active"));
        btn.classList.add("active");
      }

      buttons.forEach((btn) => {
        btn.onclick = () => {
          const filter = btn.dataset.filter || "all";
          setActive(btn);
          applyFilter(filter);
        };
      });

      const allBtn = document.querySelector('.filter-btn[data-filter="all"]');
      if (allBtn) {
        setActive(allBtn);
        applyFilter("all");
      }
    }

    document.addEventListener("astro:page-load", initProjectFilter);
    window.addEventListener("load", initProjectFilter);
  })();
</script>
